<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Lucky - Professional Cashier Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.min.js"></script>
  <!-- Existing styles remain unchanged -->
  <style>
    /* Existing styles from the provided cashier.html */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(145deg, #0f172a 0%, #1e293b 50%, #334155 100%);
      min-height: 100vh;
      color: white;
    }
    .container {
      width: 100%;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: linear-gradient(145deg, #0f172a 0%, #1e293b 100%);
    }
    .header {
      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
      padding: 1rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      border-bottom: 1px solid rgba(59, 130, 246, 0.3);
    }
    .header-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .logo {
      width: 2.5rem;
      height: 2.5rem;
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      border-radius: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 1.125rem;
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
    }
    .header-title {
      font-size: clamp(1.25rem, 2.5vw, 1.5rem);
      font-weight: 700;
      color: white;
      letter-spacing: -0.5px;
    }
    .header-right {
      display: flex;
      align-items: center;
      gap: 1rem;
      font-size: clamp(0.75rem, 1.5vw, 0.875rem);
      color: rgba(255, 255, 255, 0.8);
    }
    .balance {
      background: rgba(34, 197, 94, 0.2);
      color: #22c55e;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-weight: 600;
      border: 1px solid rgba(34, 197, 94, 0.3);
    }
    .content {
      display: flex;
      flex: 1;
      gap: 1.5rem;
      padding: 1.5rem;
      min-height: 0;
    }
    .left-panel {
      flex: 3;
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }
    .control-section {
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(148, 163, 184, 0.1);
      border-radius: 1rem;
      padding: 1.25rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
    }
    .section-title {
      font-size: clamp(0.875rem, 1.5vw, 1rem);
      font-weight: 600;
      color: white;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .section-icon {
      width: 1.25rem;
      height: 1.25rem;
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      border-radius: 0.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
    }
    .controls-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 0.75rem;
    }
    .ball-grid {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: clamp(0.25rem, 1vw, 0.75rem);
      padding: 1.5rem;
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(148, 163, 184, 0.1);
      border-radius: 1rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      flex: 1;
    }
    .ball {
      aspect-ratio: 1;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: clamp(0.625rem, 1.2vw, 0.875rem);
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      width: 100%;
      height: 100%;
      min-width: 30px;
      min-height: 30px;
      max-width: 60px;
      max-height: 60px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3), inset 0 2px 4px rgba(255,255,255,0.8);
      border: 2px solid rgba(0,0,0,0.2);
    }
    .ball::before {
      content: '';
      position: absolute;
      top: 6px;
      left: 6px;
      width: 12px;
      height: 12px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.3) 70%, transparent 100%);
      border-radius: 50%;
      pointer-events: none;
    }
    .ball[data-number="1"], .ball[data-number="16"], .ball[data-number="24"], .ball[data-number="32"], .ball[data-number="40"], .ball[data-number="48"] {
      background: #fbbf24; /* Yellow */
      color: #000;
    }
    .ball[data-number="2"], .ball[data-number="17"], .ball[data-number="25"], .ball[data-number="33"], .ball[data-number="41"] {
      background: #3b82f6; /* Blue */
      color: #fff;
    }
    .ball[data-number="3"], .ball[data-number="18"], .ball[data-number="26"], .ball[data-number="34"], .ball[data-number="42"] {
      background: #dc2626; /* Red */
      color: #fff;
    }
    .ball[data-number="4"], .ball[data-number="19"], .ball[data-number="27"], .ball[data-number="35"], .ball[data-number="43"] {
      background: #7c3aed; /* Purple */
      color: #fff;
    }
    .ball[data-number="5"], .ball[data-number="20"], .ball[data-number="28"], .ball[data-number="36"], .ball[data-number="44"] {
      background: #ea580c; /* Orange */
      color: #fff;
    }
    .ball[data-number="6"], .ball[data-number="21"], .ball[data-number="29"], .ball[data-number="37"], .ball[data-number="45"] {
      background: #16a34a; /* Green */
      color: #fff;
    }
    .ball[data-number="7"], .ball[data-number="22"], .ball[data-number="30"], .ball[data-number="38"], .ball[data-number="46"] {
      background: #7f1d1d; /* Maroon */
      color: #fff;
    }
    .ball[data-number="8"], .ball[data-number="23"], .ball[data-number="31"], .ball[data-number="39"], .ball[data-number="47"] {
      background: #1f2937; /* Black */
      color: #fff;
    }
    .ball[data-number="9"] {
      background: linear-gradient(45deg, #fbbf24 25%, #fff 25%, #fff 50%, #fbbf24 50%, #fbbf24 75%, #fff 75%);
      background-size: 8px 8px;
      color: #000;
    }
    .ball[data-number="10"] {
      background: linear-gradient(45deg, #3b82f6 25%, #fff 25%, #fff 50%, #3b82f6 50%, #3b82f6 75%, #fff 75%);
      background-size: 8px 8px;
      color: #000;
    }
    .ball[data-number="11"] {
      background: linear-gradient(45deg, #dc2626 25%, #fff 25%, #fff 50%, #dc2626 50%, #dc2626 75%, #fff 75%);
      background-size: 8px 8px;
      color: #000;
    }
    .ball[data-number="12"] {
      background: linear-gradient(45deg, #7c3aed 25%, #fff 25%, #fff 50%, #7c3aed 50%, #7c3aed 75%, #fff 75%);
      background-size: 8px 8px;
      color: #000;
    }
    .ball[data-number="13"] {
      background: linear-gradient(45deg, #ea580c 25%, #fff 25%, #fff 50%, #ea580c 50%, #ea580c 75%, #fff 75%);
      background-size: 8px 8px;
      color: #000;
    }
    .ball[data-number="14"] {
      background: linear-gradient(45deg, #16a34a 25%, #fff 25%, #fff 50%, #16a34a 50%, #16a34a 75%, #fff 75%);
      background-size: 8px 8px;
      color: #000;
    }
    .ball[data-number="15"] {
      background: linear-gradient(45deg, #7f1d1d 25%, #fff 25%, #fff 50%, #7f1d1d 50%, #7f1d1d 75%, #fff 75%);
      background-size: 8px 8px;
      color: #000;
    }
    .ball:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 12px rgba(0,0,0,0.4), inset 0 2px 4px rgba(255,255,255,0.8);
    }
    .ball.selected {
      box-shadow: 0 0 0 4px #fbbf24, 0 6px 12px rgba(0,0,0,0.4), inset 0 2px 4px rgba(255,255,255,0.8);
      transform: scale(1.1);
    }
    .ball.drawn {
      box-shadow: 0 0 0 4px #f59e0b, 0 6px 12px rgba(245, 158, 11, 0.5), inset 0 2px 4px rgba(255,255,255,0.8);
      animation: pulse-glow 2s infinite;
    }
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 4px 16px rgba(245, 158, 11, 0.4); }
      50% { box-shadow: 0 8px 32px rgba(245, 158, 11, 0.6); }
    }
    .btn {
      padding: 0.75rem 1.25rem;
      border: none;
      border-radius: 0.625rem;
      cursor: pointer;
      font-weight: 600;
      font-size: clamp(0.75rem, 1.5vw, 0.875rem);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      color: white;
      border: 1px solid rgba(59, 130, 246, 0.3);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
      position: relative;
      overflow: hidden;
    }
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    .btn:hover::before {
      left: 100%;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.3);
    }
    .btn:active {
      transform: translateY(0);
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .right-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      min-width: 250px;
      max-width: 400px;
      overflow-y: auto;
      max-height: calc(100vh - 7.5rem);
    }
    .bet-info-section {
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(148, 163, 184, 0.1);
      border-radius: 1rem;
      padding: 1.25rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      flex-shrink: 0;
    }
    .queued-tickets-section {
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(148, 163, 184, 0.1);
      border-radius: 1rem;
      padding: 1.25rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      flex-grow: 1;
      overflow-y: auto;
    }
    .queued-ticket {
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 0.5rem;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
      font-size: clamp(0.75rem, 1.5vw, 0.875rem);
      color: rgba(255, 255, 255, 0.9);
    }
    .queued-ticket-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    .queued-ticket-id {
      font-weight: 700;
      color: #3b82f6;
    }
    .queued-ticket-remove {
      cursor: pointer;
      color: #dc2626;
      font-size: 0.875rem;
      font-weight: 600;
    }
    .queued-ticket-remove:hover {
      color: #b91c1c;
    }
    .queued-ticket-details {
      font-size: clamp(0.625rem, 1.2vw, 0.75rem);
      color: rgba(255, 255, 255, 0.7);
    }
    .bet-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    .bet-label {
      font-weight: 600;
      color: rgba(255, 255, 255, 0.9);
      font-size: clamp(0.75rem, 1.5vw, 0.875rem);
    }
    .bet-input, .bet-select {
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 0.5rem;
      padding: 0.625rem 0.75rem;
      color: white;
      font-weight: 600;
      width: 100%;
      max-width: 140px;
      transition: all 0.3s ease;
    }
    .bet-input:focus, .bet-select:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    .ticket-display {
      background: linear-gradient(145deg, rgba(15, 23, 42, 0.9) 0%, rgba(30, 41, 59, 0.7) 100%);
      border: 1px solid rgba(148, 163, 184, 0.1);
      border-radius: 1rem;
      padding: 1.5rem;
      min-height: 120px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(20px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
    }
    .ticket-title {
      font-size: clamp(0.875rem, 1.5vw, 1rem);
      font-weight: 600;
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 0.75rem;
    }
    .selected-numbers-display {
      font-size: clamp(1rem, 2vw, 1.5rem);
      font-weight: 700;
      color: white;
      text-align: center;
      letter-spacing: 2px;
      line-height: 1.4;
    }
    .action-buttons {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    .btn-delete {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
      border-color: rgba(220, 38, 38, 0.3);
      box-shadow: 0 4px 12px rgba(220, 38, 38, 0.2);
    }
    .btn-delete:hover {
      box-shadow: 0 8px 24px rgba(220, 38, 38, 0.3);
    }
    .btn-success {
      background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
      border-color: rgba(34, 197, 94, 0.3);
      box-shadow: 0 4px 12px rgba(34, 197, 94, 0.2);
    }
    .btn-success:hover {
      box-shadow: 0 8px 24px rgba(34, 197, 94, 0.3);
    }
    .footer {
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(20px);
      border-top: 1px solid rgba(148, 163, 184, 0.1);
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: clamp(0.75rem, 1.5vw, 0.875rem);
    }
    .footer-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .language-selector {
      background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }
    .footer-links {
      display: flex;
      gap: 1rem;
    }
    .footer-link {
      color: rgba(255, 255, 255, 0.6);
      text-decoration: none;
      transition: color 0.3s ease;
    }
    .footer-link:hover {
      color: #3b82f6;
    }
    .footer-right {
      display: flex;
      align-items: center;
      gap: 1.25rem;
      color: rgba(255, 255, 255, 0.8);
    }
    .status-indicator {
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }
    .status-dot {
      width: 0.5rem;
      height: 0.5rem;
      background: #22c55e;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    @media screen and (max-width: 1024px) {
      .content {
        flex-direction: column;
        gap: 1rem;
        padding: 1rem;
      }
      .right-panel {
        order: -1;
        min-width: 100%;
        max-width: 100%;
      }
      .ball-grid {
        grid-template-columns: repeat(8, 1fr);
        gap: clamp(0.25rem, 0.8vw, 0.5rem);
        padding: 1rem;
      }
      .controls-grid {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 0.5rem;
      }
      .bet-input, .bet-select {
        max-width: 100%;
      }
    }
    @media screen and (max-width: 768px) {
      .ball-grid {
        grid-template-columns: repeat(8, 1fr);
        gap: clamp(0.2rem, 0.7vw, 0.375rem);
        padding: 0.75rem;
      }
      .ball {
        min-width: 25px;
        min-height: 25px;
        max-width: 40px;
        max-height: 40px;
        font-size: clamp(0.5rem, 1vw, 0.625rem);
      }
      .ball::before {
        top: 4px;
        left: 4px;
        width: 8px;
        height: 8px;
      }
      .header {
        padding: 0.75rem 1rem;
        flex-wrap: wrap;
        gap: 0.5rem;
      }
      .header-title {
        font-size: clamp(1rem, 2vw, 1.25rem);
      }
      .header-right {
        flex-wrap: wrap;
        gap: 0.5rem;
      }
      .footer {
        flex-direction: column;
        gap: 0.75rem;
        text-align: center;
        padding: 0.75rem 1rem;
      }
      .footer-right {
        flex-direction: column;
        gap: 0.5rem;
      }
      .bet-input, .bet-select {
        padding: 0.5rem 0.625rem;
      }
      .btn {
        padding: 0.625rem 1rem;
      }
      .language-selector {
        padding: 0.375rem 0.75rem;
      }
    }
    @media screen and (max-width: 480px) {
      .ball-grid {
        grid-template-columns: repeat(8, 1fr);
        gap: clamp(0.15rem, 0.6vw, 0.25rem);
      }
      .ball {
        min-width: 20px;
        min-height: 20px;
        max-width: 35px;
        max-height: 35px;
        font-size: clamp(0.375rem, 0.8vw, 0.5rem);
      }
      .ball::before {
        top: 3px;
        left: 3px;
        width: 6px;
        height: 6px;
      }
      .controls-grid {
        grid-template-columns: 1fr;
      }
      .header {
        padding: 0.5rem 0.75rem;
      }
      .header-title {
        font-size: clamp(0.875rem, 2vw, 1rem);
      }
      .header-right {
        font-size: clamp(0.625rem, 1.5vw, 0.75rem);
      }
      .bet-row {
        flex-direction: column;
        gap: 0.5rem;
        align-items: stretch;
      }
      .bet-label {
        font-size: clamp(0.625rem, 1.5vw, 0.75rem);
      }
      .section-title {
        font-size: clamp(0.75rem, 1.5vw, 0.875rem);
      }
      .btn {
        font-size: clamp(0.625rem, 1.5vw, 0.75rem);
      }
      .ticket-display {
        padding: 1rem;
      }
      .selected-numbers-display {
        font-size: clamp(0.875rem, 2vw, 1rem);
      }
      .queued-ticket {
        padding: 0.5rem;
        font-size: clamp(0.625rem, 1.2vw, 0.75rem);
      }
      .queued-ticket-details {
        font-size: clamp(0.5rem, 1vw, 0.625rem);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="header-left">
        <div class="logo">M</div>
        <div class="header-title">My Lucky Professional</div>
      </div>
      <div class="header-right">
        <div class="status-indicator">
          <div class="status-dot"></div>
          <span id="connection-status">Connecting...</span>
        </div>
        <div>Session: <span id="game-id">Waiting...</span></div>
        <div class="balance">250.16 NAD</div>
      </div>
    </div>
    
    <!-- Main Content -->
    <div class="content">
      <div class="left-panel">
        <!-- Quick Actions -->
        <div class="control-section">
          <div class="section-title">
            <div class="section-icon">‚ö°</div>
            Quick Actions
          </div>
          <div class="controls-grid">
            <button class="btn" onclick="firstBallColor()">First Ball Color</button>
            <button class="btn" onclick="firstBall24_5()">First Ball 24.5</button>
            <button class="btn" onclick="firstBallOddEven()">First Ball Odd/Even</button>
            <button class="btn" onclick="winningBallEvenOdd()">Winning Ball Even/Odd</button>
            <button class="btn" onclick="randomSelect(6)">Random 6</button>
            <button class="btn" onclick="randomSelect(7)">Random 7</button>
            <button class="btn" onclick="randomSelect(8)">Random 8</button>
            <button class="btn" onclick="randomSelect(9)">Random 9</button>
            <button class="btn" onclick="randomSelect(10)">Random 10</button>
            <button class="btn" onclick="playAllColors()">Play All Colors</button>
            <button class="btn" onclick="copyTicket()">Copy Ticket</button>
            <button class="btn" onclick="quickPick()">Quick Pick</button>
          </div>
        </div>
        
        <!-- Ball Selection Grid -->
        <div class="ball-grid" id="ballGrid">
          <!-- Balls will be generated by JavaScript -->
        </div>
      </div>
      
      <!-- Right Panel -->
      <div class="right-panel">
        <!-- Bet Information -->
        <div class="bet-info-section">
          <div class="section-title">
            <div class="section-icon">üí∞</div>
            Bet Configuration
          </div>
          <div class="bet-row">
            <span class="bet-label">Bet Type:</span>
            <select class="bet-select" id="betType" onchange="updateBetType()">
              <option value="future1">Future Bet 1 - Game</option>
              <option value="future2">Future Bet 2 - Premium</option>
              <option value="instant">Instant Play</option>
              <option value="multi">Multi Draw</option>
            </select>
          </div>
          <div class="bet-row">
            <span class="bet-label">Stake Amount:</span>
            <input type="number" class="bet-input" id="stakeInput" value="106.00" min="1" step="0.01" onchange="updateStake()">
          </div>
        </div>
        
        <!-- Selected Numbers Display -->
        <div class="ticket-display">
          <div class="ticket-title">Selected Numbers</div>
          <div class="selected-numbers-display" id="selectedNumbers">
            Select numbers to play
          </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="bet-info-section">
          <div class="section-title">
            <div class="section-icon">üéÆ</div>
            Actions
          </div>
          <div class="action-buttons">
            <button class="btn btn-delete" onclick="deleteAll()">üóëÔ∏è DELETE ALL</button>
            <button class="btn" onclick="confirmTicket()">‚úÖ CONFIRM TICKET</button>
            <button class="btn btn-success" id="play-ticket-btn" onclick="playTicket()">üéÆ PLAY TICKET</button>
          </div>
        </div>
        
        <!-- Queued Tickets -->
        <div class="queued-tickets-section">
          <div class="section-title">
            <div class="section-icon">üé´</div>
            Queued Tickets
          </div>
          <div id="queued-tickets">
            <!-- Queued tickets will be displayed here -->
          </div>
        </div>
      </div>
    </div>
    
    <!-- Footer -->
    <div class="footer">
      <div class="footer-left">
        <button class="language-selector">
          üá¨üáß English
        </button>
        <div class="footer-links">
          <a href="#" class="footer-link" onclick="checkSlip()">Check Slip</a>
          <a href="#" class="footer-link" onclick="showTerms()">Terms of Service</a>
          <a href="#" class="footer-link" onclick="showHelp()">Help & Support</a>
        </div>
      </div>
      <div class="footer-right">
        <div id="current-time">20:53 | 14/07/2025</div>
        <div>Cashier Terminal #001</div>
      </div>
    </div>
  </div>

  <script>
    let selectedNumbers = [];
    let currentStake = 106.00;
    let betType = 'future1';
    let ticketQueue = [];
    let gameState = {
      isRunning: false,
      drawnBalls: [],
      availableBalls: Array.from({length: 48}, (_, i) => i + 1),
      gameId: "BG-" + Math.floor(10000 + Math.random() * 90000),
      currentBall: null,
      recentBalls: [],
      lastUpdate: Date.now(),
      bonusAmounts: { bronze: 705.66, silver: 792.56, gold: 1250.00 },
      players: []
    };

    // Stake amounts for Random selections
    const randomStakeAmounts = {
      6: 5,
      7: 6,
      8: 16,
      9: 24,
      10: 46
    };

    // DOM Elements
    const connectionStatus = document.getElementById('connection-status');
    const gameIdDisplay = document.getElementById('game-id');
    const currentTime = document.getElementById('current-time');
    const playTicketBtn = document.getElementById('play-ticket-btn');
    const queuedTicketsDisplay = document.getElementById('queued-tickets');

    // Socket.io connection
    let socket;
    async function initSocket() {
      const token = localStorage.getItem('token');
      if (!token) {
        showNotification('Please log in first', 'error');
        window.location.href = '/index.html';
        return;
      }
      try {
        const response = await fetch('http://localhost:3000/port', {
          signal: AbortSignal.timeout(2000),
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const data = await response.json();
        socket = io(`http://localhost:${data.port || 3000}`, {
          reconnectionAttempts: 5,
          reconnectionDelay: 1000,
          timeout: 10000,
          auth: { token }
        });
        setupSocketHandlers();
      } catch (err) {
        console.error('Failed to fetch server port:', err);
        showNotification('Failed to connect to server', 'error');
        connectionStatus.textContent = 'Offline';
        document.querySelector('.status-dot').style.background = '#dc2626';
      }
    }

    function setupSocketHandlers() {
      socket.on('connect', () => {
        console.log('Socket connected, ID:', socket.id);
        socket.emit('authenticate', localStorage.getItem('token'));
      });

      socket.on('authenticated', ({ role }) => {
        console.log(`Authenticated as ${role}`);
        updateGameStatus();
        showNotification(`Connected as ${role}`, 'success');
        socket.emit('requestGameState');
        fetchTickets();
      });

      socket.on('authError', (message) => {
        console.error('Authentication error:', message);
        showNotification('Authentication failed. Please log in again.', 'error');
        localStorage.removeItem('token');
        window.location.href = '/index.html';
      });

      socket.on('disconnect', () => {
        console.log('Socket disconnected');
        updateGameStatus();
        showNotification('Disconnected from server', 'error');
      });

      socket.on('gameState', (newState) => {
        console.log('Received gameState:', newState);
        gameState = { ...gameState, ...newState };
        updateGameStatus();
        fetchTickets();
      });

      socket.on('gameStarted', (data) => {
        console.log('Received gameStarted:', data);
        gameState.isRunning = true;
        gameState.gameId = data.gameId;
        updateGameStatus();
        showNotification('Game started');
      });

      socket.on('ballDrawn', (ballData) => {
        console.log('Received ballDrawn:', ballData);
        gameState.drawnBalls.push(ballData.number);
        gameState.availableBalls = gameState.availableBalls.filter(b => b !== ballData.number);
        gameState.currentBall = ballData.number;
        gameState.recentBalls.unshift(ballData.number);
        if (gameState.recentBalls.length > 10) {
          gameState.recentBalls.pop();
        }
        updateGameStatus();
        showNotification(`Ball drawn: ${ballData.number}`);
      });

      socket.on('bonusBall', (bonusBall) => {
        console.log('Received bonusBall:', bonusBall);
        gameState.bonusBall = bonusBall;
        showNotification(`Bonus ball drawn: ${bonusBall}`);
      });

      socket.on('winner', ({ player, prize }) => {
        console.log('Received winner:', player, prize);
        showNotification(`Winner: ${player} wins ${prize} NAD!`, 'success');
      });

      socket.on('gameReset', () => {
        console.log('Received gameReset');
        gameState.isRunning = false;
        gameState.drawnBalls = [];
        gameState.availableBalls = Array.from({length: 48}, (_, i) => i + 1);
        gameState.currentBall = null;
        gameState.recentBalls = [];
        gameState.gameId = null; // Reset gameId to null
        gameState.players = [];
        ticketQueue = [];
        updateGameStatus();
        updateQueuedTicketsDisplay();
        fetchTickets();
        showNotification('Game reset');
      });

      socket.on('error', (message) => {
        console.error('Server error:', message);
        showNotification(message, 'error');
      });
    }

    // Fetch tickets for the current game
    async function fetchTickets() {
      const token = localStorage.getItem('token');
      try {
        const response = await fetch(`http://localhost:3000/tickets?gameId=${gameState.gameId || ''}`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const data = await response.json();
        if (data.success) {
          gameState.players = data.tickets.map(ticket => ({
            name: ticket.player_name,
            tickets: [JSON.parse(ticket.lucky_numbers)],
            balance: ticket.ticket_price,
            slipNumber: ticket.slip_number,
            wins: 0
          }));
          console.log('Fetched tickets:', gameState.players);
        } else {
          showNotification(data.message || 'Failed to fetch tickets', 'error');
        }
      } catch (err) {
        console.error('Error fetching tickets:', err);
        showNotification('Error fetching tickets', 'error');
      }
    }

    // Initialize the application
    function init() {
      const token = localStorage.getItem('token');
      if (!token) {
        window.location.href = '/index.html';
        return;
      }
      generateBalls();
      updateSelectedDisplay();
      updateQueuedTicketsDisplay();
      updateGameStatus();
      updateTime();
      setInterval(updateTime, 1000);
      initSocket();
    }

    // Generate balls dynamically
    function generateBalls() {
      const ballGrid = document.getElementById('ballGrid');
      ballGrid.innerHTML = '';
      
      for (let i = 1; i <= 48; i++) {
        const ball = document.createElement('div');
        ball.className = 'ball';
        ball.setAttribute('data-number', i);
        ball.textContent = i;
        
        ball.addEventListener('click', () => toggleBall(i));
        ballGrid.appendChild(ball);
      }
      
      // Preselect specific numbers to match screenshot
      const preselectedNumbers = [4, 9, 11, 21, 24, 29, 30, 37, 39, 44];
      selectedNumbers = [...preselectedNumbers];
      
      preselectedNumbers.forEach(num => {
        const ball = document.querySelector(`[data-number="${num}"]`);
        if (ball) {
          ball.classList.add('selected');
        }
      });
      
      updateSelectedDisplay();
    }

    // Toggle ball selection
    function toggleBall(number) {
      const ball = document.querySelector(`[data-number="${number}"]`);
      const index = selectedNumbers.indexOf(number);
      
      if (index === -1) {
        selectedNumbers.push(number);
        ball.classList.add('selected');
      } else {
        selectedNumbers.splice(index, 1);
        ball.classList.remove('selected');
      }
      
      updateSelectedDisplay();
    }

    // Update selected numbers display
    function updateSelectedDisplay() {
      const display = document.getElementById('selectedNumbers');
      if (selectedNumbers.length === 0) {
        display.textContent = 'Select numbers to play';
        display.style.opacity = '0.6';
      } else {
        selectedNumbers.sort((a, b) => a - b);
        display.textContent = selectedNumbers.join(' ');
        display.style.opacity = '1';
      }
    }

    // Update queued tickets display
    function updateQueuedTicketsDisplay() {
      queuedTicketsDisplay.innerHTML = '';
      if (ticketQueue.length === 0) {
        const emptyMessage = document.createElement('div');
        emptyMessage.textContent = 'No tickets queued';
        emptyMessage.style.color = 'rgba(255, 255, 255, 0.6)';
        emptyMessage.style.textAlign = 'center';
        queuedTicketsDisplay.appendChild(emptyMessage);
        return;
      }
      
      ticketQueue.forEach((ticket, index) => {
        const ticketElement = document.createElement('div');
        ticketElement.className = 'queued-ticket';
        ticketElement.innerHTML = `
          <div class="queued-ticket-header">
            <span class="queued-ticket-id">Ticket ${ticket.ticketId}</span>
            <span class="queued-ticket-remove" onclick="removeQueuedTicket(${index})">Remove</span>
          </div>
          <div class="queued-ticket-details">
            Numbers: ${ticket.luckyNumbers.join(' ')}<br>
            Stake: ${ticket.ticketPrice.toFixed(2)} NAD<br>
            Bet Type: ${ticket.betType}
          </div>
        `;
        queuedTicketsDisplay.appendChild(ticketElement);
      });
    }

    // Remove a queued ticket
    function removeQueuedTicket(index) {
      ticketQueue.splice(index, 1);
      updateQueuedTicketsDisplay();
      showNotification(`Ticket removed from queue`);
    }

    // Update game status
    function updateGameStatus() {
      gameIdDisplay.textContent = gameState.gameId || 'Waiting...';
      connectionStatus.textContent = socket && socket.connected ? 'Online' : 'Offline';
      document.querySelector('.status-dot').style.background = socket && socket.connected ? '#22c55e' : '#dc2626';
      
      // Update drawn balls
      document.querySelectorAll('.ball').forEach(ball => {
        const num = parseInt(ball.getAttribute('data-number'));
        if (gameState.drawnBalls.includes(num)) {
          ball.classList.add('drawn');
        } else {
          ball.classList.remove('drawn');
        }
      });
      
      // Disable Play Ticket button if game is running
      playTicketBtn.disabled = gameState.isRunning;
      playTicketBtn.style.opacity = gameState.isRunning ? '0.5' : '1';
    }

    // Update time display
    function updateTime() {
      const now = new Date();
      const timeString = now.toLocaleString('en-US', { 
        hour: '2-digit', 
        minute: '2-digit', 
        day: '2-digit', 
        month: '2-digit', 
        year: 'numeric' 
      });
      currentTime.textContent = timeString.replace(',', ' |');
    }

    // Quick action functions
    function randomSelect(count) {
      clearSelection();
      const numbers = [];
      
      while (numbers.length < count) {
        const randomNum = Math.floor(Math.random() * 48) + 1;
        if (!numbers.includes(randomNum)) {
          numbers.push(randomNum);
        }
      }
      
      selectedNumbers = numbers;
      numbers.forEach(num => {
        document.querySelector(`[data-number="${num}"]`).classList.add('selected');
      });
      
      // Set stake amount based on count
      if (randomStakeAmounts[count]) {
        currentStake = randomStakeAmounts[count];
        document.getElementById('stakeInput').value = currentStake.toFixed(2);
        updateStake();
      }
      
      updateSelectedDisplay();
      showNotification(`${count} random numbers selected with stake N$${currentStake.toFixed(2)}`);
    }
    
    function firstBallColor() {
      showNotification('First Ball Color prediction activated');
    }
    
    function firstBall24_5() {
      const ball = Math.random() > 0.5 ? 24 : 25;
      toggleBall(ball);
      showNotification(`First Ball 24.5 prediction: ${ball}`);
    }
    
    function firstBallOddEven() {
      showNotification('First Ball Odd/Even prediction activated');
    }
    
    function winningBallEvenOdd() {
      showNotification('Winning Ball Even/Odd prediction activated');
    }
    
    function playAllColors() {
      const colorNumbers = [6, 7, 15, 23, 31, 39, 42, 48];
      clearSelection();
      selectedNumbers = colorNumbers;
      colorNumbers.forEach(num => {
        document.querySelector(`[data-number="${num}"]`).classList.add('selected');
      });
      updateSelectedDisplay();
      showNotification('All color numbers selected');
    }
    
    function quickPick() {
      randomSelect(10);
    }
    
    function copyTicket() {
      if (selectedNumbers.length === 0 && ticketQueue.length === 0) {
        showNotification('No numbers or queued tickets to copy', 'error');
        return;
      }
      
      let ticketText = 'My Lucky Professional Tickets\n';
      if (selectedNumbers.length > 0) {
        ticketText += `Current Selection\nNumbers: ${selectedNumbers.join(' ')}\nStake: ${currentStake} NAD\nBet Type: ${betType}\n\n`;
      }
      ticketQueue.forEach(ticket => {
        ticketText += `Ticket ${ticket.ticketId}\nNumbers: ${ticket.luckyNumbers.join(' ')}\nStake: ${ticket.ticketPrice} NAD\nBet Type: ${ticket.betType}\n\n`;
      });
      navigator.clipboard.writeText(ticketText).then(() => {
        showNotification('Tickets copied to clipboard');
      });
    }
    
    // Clear all selections
    function clearSelection() {
      selectedNumbers = [];
      document.querySelectorAll('.ball.selected').forEach(ball => {
        ball.classList.remove('selected');
      });
    }
    
    // Update stake
    function updateStake() {
      const stakeInput = document.getElementById('stakeInput');
      currentStake = parseFloat(stakeInput.value) || 106.00;
      showNotification(`Stake updated to ${currentStake} NAD`);
    }
    
    // Update bet type
    function updateBetType() {
      const betTypeSelect = document.getElementById('betType');
      betType = betTypeSelect.value;
      showNotification(`Bet type changed to ${betType}`);
    }
    
    // Action functions
    function deleteAll() {
      if (selectedNumbers.length === 0) {
        showNotification('No numbers to delete', 'error');
        return;
      }
      
      clearSelection();
      updateSelectedDisplay();
      showNotification('All selections cleared');
    }
    
    function confirmTicket() {
      if (selectedNumbers.length === 0) {
        showNotification('Please select numbers first', 'error');
        return;
      }
      
      const ticketId = 'ML-' + Math.random().toString(36).substr(2, 9).toUpperCase();
      ticketQueue.push({
        ticketId,
        playerName: 'Player_' + ticketId,
        luckyNumbers: [...selectedNumbers],
        ticketPrice: currentStake,
        betType,
        slipNumber: ticketId
      });
      
      clearSelection();
      updateSelectedDisplay();
      updateQueuedTicketsDisplay();
      showNotification(`Ticket ${ticketId} queued for play`);
    }
    
    async function playTicket() {
      const token = localStorage.getItem('token');
      if (!token) {
        showNotification('Please log in first', 'error');
        window.location.href = '/index.html';
        return;
      }
      
      if (ticketQueue.length === 0) {
        showNotification('No tickets queued to play', 'error');
        return;
      }
      
      if (gameState.isRunning) {
        showNotification('Cannot play tickets: Game already running', 'error');
        return;
      }
      
      playTicketBtn.disabled = true;
      playTicketBtn.style.opacity = '0.5';
      
      try {
        // Step 1: Ensure an active game exists
        if (!gameState.gameId) {
          const playResponse = await fetch('http://localhost:3000/play-ticket', {
            method: 'POST',
            headers: { 
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            }
          });
          const playData = await playResponse.json();
          
          if (!playData.success) {
            showNotification(playData.message || 'Failed to start game', 'error');
            playTicketBtn.disabled = false;
            playTicketBtn.style.opacity = '1';
            return;
          }
          
          // Update local gameState with new gameId
          gameState.gameId = playData.gameId;
          gameIdDisplay.textContent = gameState.gameId;
          showNotification(`New game started: ${gameState.gameId}`);
        }
        
        // Step 2: Submit all queued tickets
        for (const ticket of ticketQueue) {
          const sellResponse = await fetch('http://localhost:3000/sell-ticket', {
            method: 'POST',
            headers: { 
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
              playerName: ticket.playerName,
              ticketPrice: ticket.ticketPrice,
              luckyNumbers: ticket.luckyNumbers,
              slipNumber: ticket.slipNumber
            })
          });
          const sellData = await sellResponse.json();
          
          if (!sellData.success) {
            showNotification(`Failed to submit ticket ${ticket.ticketId}: ${sellData.message || 'Unknown error'}`, 'error');
            playTicketBtn.disabled = false;
            playTicketBtn.style.opacity = '1';
            return;
          }
        }
        
        // Step 3: Notify display to start countdown
        socket.emit('playTicket', { gameId: gameState.gameId });
        showNotification(`Submitted ${ticketQueue.length} tickets and started game!`);
        
        // Clear queue and reset
        ticketQueue = [];
        clearSelection();
        updateSelectedDisplay();
        updateQueuedTicketsDisplay();
        playTicketBtn.disabled = gameState.isRunning;
        playTicketBtn.style.opacity = gameState.isRunning ? '0.5' : '1';
      } catch (error) {
        console.error('Play ticket error:', error);
        showNotification('Error submitting tickets or starting game', 'error');
        playTicketBtn.disabled = false;
        playTicketBtn.style.opacity = '1';
      }
    }
    
    async function checkSlip() {
      const token = localStorage.getItem('token');
      if (!token) {
        showNotification('Please log in first', 'error');
        window.location.href = '/index.html';
        return;
      }
      
      const slipNumber = prompt('Enter Slip Number (e.g., ML-ABC123):');
      if (!slipNumber) {
        showNotification('No slip number entered', 'error');
        return;
      }
      
      try {
        const response = await fetch(`http://localhost:3000/check-slip?slipNumber=${encodeURIComponent(slipNumber)}`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const data = await response.json();
        if (data.success) {
          const ticket = data.ticket;
          const numbers = JSON.parse(ticket.lucky_numbers);
          const message = `Ticket Details\nSlip: ${ticket.slip_number}\nGame: ${ticket.game_id}\nPlayer: ${ticket.player_name}\nNumbers: ${numbers.join(' ')}\nStake: ${ticket.ticket_price} NAD\nCreated: ${new Date(ticket.created_at).toLocaleString()}`;
          showNotification(message);
        } else {
          showNotification(data.message || 'Ticket not found', 'error');
        }
      } catch (err) {
        console.error('Error checking slip:', err);
        showNotification('Error checking slip', 'error');
      }
    }
    
    function showTerms() {
      showNotification('Opening terms of service...');
    }
    
    function showHelp() {
      showNotification('Opening help and support...');
    }
    
    // Notification system
    function showNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'error' ? 'linear-gradient(135deg, #dc2626, #b91c1c)' : 'linear-gradient(135deg, #16a34a, #15803d)'};
        color: white;
        padding: 16px 20px;
        border-radius: 12px;
        font-weight: 600;
        z-index: 1000;
        box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255,255,255,0.1);
        transform: translateX(100%);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        max-width: 300px;
        white-space: pre-wrap;
      `;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.transform = 'translateX(0)';
      }, 100);
      
      setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 5000);
    }

    // Initialize when page loads
    window.addEventListener('load', init);
  </script>
</body>
</html>