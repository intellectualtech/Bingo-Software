<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Lucky - Professional Cashier Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.min.js"></script>
  <style>
    /* Existing styles remain unchanged */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(145deg, #0f172a 0%, #1e293b 50%, #334155 100%);
      min-height: 100vh;
      color: white;
    }
    .container {
      width: 100%;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: linear-gradient(145deg, #0f172a 0%, #1e293b 100%);
    }
    .header {
      background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
      padding: 1rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      border-bottom: 1px solid rgba(59, 130, 246, 0.3);
    }
    .header-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .logo {
      width: 2.5rem;
      height: 2.5rem;
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      border-radius: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 1.125rem;
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
    }
    .header-title {
      font-size: clamp(1.25rem, 2.5vw, 1.5rem);
      font-weight: 700;
      color: white;
      letter-spacing: -0.5px;
    }
    .header-right {
      display: flex;
      align-items: center;
      gap: 1rem;
      font-size: clamp(0.75rem, 1.5vw, 0.875rem);
      color: rgba(255, 255, 255, 0.8);
    }
    .balance {
      background: rgba(34, 197, 94, 0.2);
      color: #22c55e;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-weight: 600;
      border: 1px solid rgba(34, 197, 94, 0.3);
    }
    .content {
      display: flex;
      flex: 1;
      gap: 1.5rem;
      padding: 1.5rem;
      min-height: 0;
    }
    .left-panel {
      flex: 3;
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }
    .control-section {
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(148, 163, 184, 0.1);
      border-radius: 1rem;
      padding: 1.25rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
    }
    .section-title {
      font-size: clamp(0.875rem, 1.5vw, 1rem);
      font-weight: 600;
      color: white;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .section-icon {
      width: 1.25rem;
      height: 1.25rem;
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      border-radius: 0.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
    }
    .controls-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 0.75rem;
    }
    .ball-grid {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: clamp(0.25rem, 1vw, 0.75rem);
      padding: 1.5rem;
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(148, 163, 184, 0.1);
      border-radius: 1rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      flex: 1;
    }
    .ball {
      aspect-ratio: 1;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: clamp(0.625rem, 1.2vw, 0.875rem);
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      width: 100%;
      height: 100%;
      min-width: 30px;
      min-height: 30px;
      max-width: 60px;
      max-height: 60px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3), inset 0 2px 4px rgba(255,255,255,0.8);
      border: 2px solid rgba(0,0,0,0.2);
    }
    .ball::before {
      content: '';
      position: absolute;
      top: 6px;
      left: 6px;
      width: 12px;
      height: 12px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.3) 70%, transparent 100%);
      border-radius: 50%;
      pointer-events: none;
    }
    .ball[data-number="1"], .ball[data-number="16"], .ball[data-number="24"], .ball[data-number="32"], .ball[data-number="40"], .ball[data-number="48"] {
      background: #fbbf24; /* Yellow */
      color: #000;
    }
    .ball[data-number="2"], .ball[data-number="17"], .ball[data-number="25"], .ball[data-number="33"], .ball[data-number="41"] {
      background: #3b82f6; /* Blue */
      color: #fff;
    }
    .ball[data-number="3"], .ball[data-number="18"], .ball[data-number="26"], .ball[data-number="34"], .ball[data-number="42"] {
      background: #dc2626; /* Red */
      color: #fff;
    }
    .ball[data-number="4"], .ball[data-number="19"], .ball[data-number="27"], .ball[data-number="35"], .ball[data-number="43"] {
      background: #7c3aed; /* Purple */
      color: #fff;
    }
    .ball[data-number="5"], .ball[data-number="20"], .ball[data-number="28"], .ball[data-number="36"], .ball[data-number="44"] {
      background: #ea580c; /* Orange */
      color: #fff;
    }
    .ball[data-number="6"], .ball[data-number="21"], .ball[data-number="29"], .ball[data-number="37"], .ball[data-number="45"] {
      background: #16a34a; /* Green */
      color: #fff;
    }
    .ball[data-number="7"], .ball[data-number="22"], .ball[data-number="30"], .ball[data-number="38"], .ball[data-number="46"] {
      background: #7f1d1d; /* Maroon */
      color: #fff;
    }
    .ball[data-number="8"], .ball[data-number="23"], .ball[data-number="31"], .ball[data-number="39"], .ball[data-number="47"] {
      background: #1f2937; /* Black */
      color: #fff;
    }
    .ball[data-number="9"] {
      background: linear-gradient(45deg, #fbbf24 25%, #fff 25%, #fff 50%, #fbbf24 50%, #fbbf24 75%, #fff 75%);
      background-size: 8px 8px;
      color: #000;
    }
    .ball[data-number="10"] {
      background: linear-gradient(45deg, #3b82f6 25%, #fff 25%, #fff 50%, #3b82f6 50%, #3b82f6 75%, #fff 75%);
      background-size: 8px 8px;
      color: #000;
    }
    .ball[data-number="11"] {
      background: linear-gradient(45deg, #dc2626 25%, #fff 25%, #fff 50%, #dc2626 50%, #dc2626 75%, #fff 75%);
      background-size: 8px 8px;
      color: #000;
    }
    .ball[data-number="12"] {
      background: linear-gradient(45deg, #7c3aed 25%, #fff 25%, #fff 50%, #7c3aed 50%, #7c3aed 75%, #fff 75%);
      background-size: 8px 8px;
      color: #000;
    }
    .ball[data-number="13"] {
      background: linear-gradient(45deg, #ea580c 25%, #fff 25%, #fff 50%, #ea580c 50%, #ea580c 75%, #fff 75%);
      background-size: 8px 8px;
      color: #000;
    }
    .ball[data-number="14"] {
      background: linear-gradient(45deg, #16a34a 25%, #fff 25%, #fff 50%, #16a34a 50%, #16a34a 75%, #fff 75%);
      background-size: 8px 8px;
      color: #000;
    }
    .ball[data-number="15"] {
      background: linear-gradient(45deg, #7f1d1d 25%, #fff 25%, #fff 50%, #7f1d1d 50%, #7f1d1d 75%, #fff 75%);
      background-size: 8px 8px;
      color: #000;
    }
    .ball:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 12px rgba(0,0,0,0.4), inset 0 2px 4px rgba(255,255,255,0.8);
    }
    .ball.selected {
      box-shadow: 0 0 0 4px #fbbf24, 0 6px 12px rgba(0,0,0,0.4), inset 0 2px 4px rgba(255,255,255,0.8);
      transform: scale(1.1);
    }
    .ball.drawn {
      box-shadow: 0 0 0 4px #f59e0b, 0 6px 12px rgba(245, 158, 11, 0.5), inset 0 2px 4px rgba(255,255,255,0.8);
      animation: pulse-glow 2s infinite;
    }
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 4px 16px rgba(245, 158, 11, 0.4); }
      50% { box-shadow: 0 8px 32px rgba(245, 158, 11, 0.6); }
    }
    .btn {
      padding: 0.75rem 1.25rem;
      border: none;
      border-radius: 0.625rem;
      cursor: pointer;
      font-weight: 600;
      font-size: clamp(0.75rem, 1.5vw, 0.875rem);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
      color: white;
      border: 1px solid rgba(59, 130, 246, 0.3);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
      position: relative;
      overflow: hidden;
    }
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    .btn:hover::before {
      left: 100%;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(59, 130, 246, 0.3);
    }
    .btn:active {
      transform: translateY(0);
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .right-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      min-width: 250px;
      max-width: 400px;
      overflow-y: auto;
      max-height: calc(100vh - 7.5rem);
    }
    .bet-info-section {
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(148, 163, 184, 0.1);
      border-radius: 1rem;
      padding: 1.25rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      flex-shrink: 0;
    }
    .queued-tickets-section {
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(148, 163, 184, 0.1);
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
      flex-grow: 1;
      overflow-y: auto;
      min-height: 200px;
    }
    .queued-ticket {
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 0.5rem;
      padding: 1rem;
      margin-bottom: 1rem;
      font-size: clamp(0.75rem, 1.5vw, 0.875rem);
      color: rgba(255, 255, 255, 0.9);
    }
    .queued-ticket-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }
    .queued-ticket-id {
      font-weight: 700;
      color: #3b82f6;
    }
    .queued-ticket-remove {
      cursor: pointer;
      color: #dc2626;
      font-size: 0.875rem;
      font-weight: 600;
    }
    .queued-ticket-remove:hover {
      color: #b91c1c;
    }
    .queued-ticket-details {
      font-size: clamp(0.625rem, 1.2vw, 0.75rem);
      color: rgba(255, 255, 255, 0.7);
      line-height: 1.5;
    }
    .bet-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    .bet-label {
      font-weight: 600;
      color: rgba(255, 255, 255, 0.9);
      font-size: clamp(0.75rem, 1.5vw, 0.875rem);
    }
    .bet-input, .bet-select {
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid rgba(148, 163, 184, 0.2);
      border-radius: 0.5rem;
      padding: 0.625rem 0.75rem;
      color: white;
      font-weight: 600;
      width: 100%;
      max-width: 140px;
      transition: all 0.3s ease;
    }
    .bet-input:focus, .bet-select:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    .ticket-display {
      background: linear-gradient(145deg, rgba(15, 23, 42, 0.9) 0%, rgba(30, 41, 59, 0.7) 100%);
      border: 1px solid rgba(148, 163, 184, 0.1);
      border-radius: 1rem;
      padding: 1.5rem;
      min-height: 120px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(20px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.2);
    }
    .ticket-title {
      font-size: clamp(0.875rem, 1.5vw, 1rem);
      font-weight: 600;
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 0.75rem;
    }
    .selected-numbers-display {
      font-size: clamp(1rem, 2vw, 1.5rem);
      font-weight: 700;
      color: white;
      text-align: center;
      letter-spacing: 2px;
      line-height: 1.4;
      max-height: 200px;
      overflow-y: auto;
      width: 100%;
    }
    .selected-numbers-row {
      margin-bottom: 0.5rem;
    }
    .action-buttons {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    .btn-delete {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
      border-color: rgba(220, 38, 38, 0.3);
      box-shadow: 0 4px 12px rgba(220, 38, 38, 0.2);
    }
    .btn-delete:hover {
      box-shadow: 0 8px 24px rgba(220, 38, 38, 0.3);
    }
    .btn-success {
      background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
      border-color: rgba(34, 197, 94, 0.3);
      box-shadow: 0 4px 12px rgba(34, 197, 94, 0.2);
    }
    .btn-success:hover {
      box-shadow: 0 8px 24px rgba(34, 197, 94, 0.3);
    }
    .footer {
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(20px);
      border-top: 1px solid rgba(148, 163, 184, 0.1);
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: clamp(0.75rem, 1.5vw, 0.875rem);
    }
    .footer-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    .language-selector {
      background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }
    .footer-links {
      display: flex;
      gap: 1rem;
    }
    .footer-link {
      color: rgba(255, 255, 255, 0.6);
      text-decoration: none;
      transition: color 0.3s ease;
    }
    .footer-link:hover {
      color: #3b82f6;
    }
    .footer-right {
      display: flex;
      align-items: center;
      gap: 1.25rem;
      color: rgba(255, 255, 255, 0.8);
    }
    .status-indicator {
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }
    .status-dot {
      width: 0.5rem;
      height: 0.5rem;
      background: #22c55e;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    @media screen and (max-width: 1024px) {
      .content {
        flex-direction: column;
        gap: 1rem;
        padding: 1rem;
      }
      .right-panel {
        order: -1;
        min-width: 100%;
        max-width: 100%;
      }
      .ball-grid {
        grid-template-columns: repeat(8, 1fr);
        gap: clamp(0.25rem, 0.8vw, 0.5rem);
        padding: 1rem;
      }
      .controls-grid {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 0.5rem;
      }
      .bet-input, .bet-select {
        max-width: 100%;
      }
      .queued-tickets-section {
        min-height: 150px;
      }
      .selected-numbers-display {
        max-height: 150px;
      }
    }
    @media screen and (max-width: 768px) {
      .ball-grid {
        grid-template-columns: repeat(8, 1fr);
        gap: clamp(0.2rem, 0.7vw, 0.375rem);
        padding: 0.75rem;
      }
      .ball {
        min-width: 25px;
        min-height: 25px;
        max-width: 40px;
        max-height: 40px;
        font-size: clamp(0.5rem, 1vw, 0.625rem);
      }
      .ball::before {
        top: 4px;
        left: 4px;
        width: 8px;
        height: 8px;
      }
      .header {
        padding: 0.75rem 1rem;
        flex-wrap: wrap;
        gap: 0.5rem;
      }
      .header-title {
        font-size: clamp(1rem, 2vw, 1.25rem);
      }
      .header-right {
        flex-wrap: wrap;
        gap: 0.5rem;
      }
      .footer {
        flex-direction: column;
        gap: 0.75rem;
        text-align: center;
        padding: 0.75rem 1rem;
      }
      .footer-right {
        flex-direction: column;
        gap: 0.5rem;
      }
      .bet-input, .bet-select {
        padding: 0.5rem 0.625rem;
      }
      .btn {
        padding: 0.625rem 1rem;
      }
      .language-selector {
        padding: 0.375rem 0.75rem;
      }
      .queued-tickets-section {
        min-height: 120px;
        padding: 1rem;
      }
      .queued-ticket {
        padding: 0.75rem;
        margin-bottom: 0.75rem;
      }
      .selected-numbers-display {
        max-height: 120px;
      }
    }
    @media screen and (max-width: 480px) {
      .ball-grid {
        grid-template-columns: repeat(8, 1fr);
        gap: clamp(0.15rem, 0.6vw, 0.25rem);
      }
      .ball {
        min-width: 20px;
        min-height: 20px;
        max-width: 35px;
        max-height: 35px;
        font-size: clamp(0.375rem, 0.8vw, 0.5rem);
      }
      .ball::before {
        top: 3px;
        left: 3px;
        width: 6px;
        height: 6px;
      }
      .controls-grid {
        grid-template-columns: 1fr;
      }
      .header {
        padding: 0.5rem 0.75rem;
      }
      .header-title {
        font-size: clamp(0.875rem, 2vw, 1rem);
      }
      .header-right {
        font-size: clamp(0.625rem, 1.5vw, 0.75rem);
      }
      .bet-row {
        flex-direction: column;
        gap: 0.5rem;
        align-items: stretch;
      }
      .bet-label {
        font-size: clamp(0.625rem, 1.5vw, 0.75rem);
      }
      .section-title {
        font-size: clamp(0.75rem, 1.5vw, 0.875rem);
      }
      .btn {
        font-size: clamp(0.625rem, 1.5vw, 0.75rem);
      }
      .ticket-display {
        padding: 1rem;
      }
      .selected-numbers-display {
        font-size: clamp(0.875rem, 2vw, 1rem);
      }
      .queued-tickets-section {
        min-height: 100px;
        padding: 0.75rem;
      }
      .queued-ticket {
        padding: 0.5rem;
        margin-bottom: 0.5rem;
      }
      .selected-numbers-display {
        max-height: 100px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-left">
        <div class="logo">M</div>
        <div class="header-title">My Lucky Professional</div>
      </div>
      <div class="header-right">
        <div class="status-indicator">
          <div class="status-dot"></div>
          <span id="connection-status">Connecting...</span>
        </div>
        <div>Session: <span id="game-id">Waiting...</span></div>
        <div class="balance" id="balance">Loading...</div>
      </div>
    </div>
    
    <div class="content">
      <div class="left-panel">
        <div class="control-section">
          <div class="section-title">
            <div class="section-icon">‚ö°</div>
            Quick Actions
          </div>
          <div class="controls-grid">
            <button class="btn" onclick="firstBallColor()">First Ball Color</button>
            <button class="btn" onclick="firstBall24_5()">First Ball 24.5</button>
            <button class="btn" onclick="firstBallOddEven()">First Ball Odd/Even</button>
            <button class="btn" onclick="winningBallEvenOdd()">Winning Ball Even/Odd</button>
            <button class="btn" onclick="randomSelect(6)">Random 6</button>
            <button class="btn" onclick="randomSelect(7)">Random 7</button>
            <button class="btn" onclick="randomSelect(8)">Random 8</button>
            <button class="btn" onclick="randomSelect(9)">Random 9</button>
            <button class="btn" onclick="randomSelect(10)">Random 10</button>
            <button class="btn" onclick="playAllColors()">Play All Colors</button>
            <button class="btn" onclick="copyTicket()">Copy Ticket</button>
            <button class="btn" onclick="quickPick()">Quick Pick</button>
            <button class="btn" onclick="randomMulti()">Random Multi</button>
          </div>
        </div>
        
        <div class="ball-grid" id="ballGrid">
        </div>
      </div>
      
      <div class="right-panel">
        <div class="bet-info-section">
          <div class="section-title">
            <div class="section-icon">üí∞</div>
            Bet Configuration
          </div>
          <div class="bet-row">
            <span class="bet-label">Bet Type:</span>
            <select class="bet-select" id="betType" onchange="updateBetType()">
              <option value="future1">Future Bet 1 - Game</option>
              <option value="future2">Future Bet 2 - Premium</option>
              <option value="instant">Instant Play</option>
              <option value="multi">Multi Draw</option>
            </select>
          </div>
          <div class="bet-row">
            <span class="bet-label">Stake Amount:</span>
            <input type="number" class="bet-input" id="stakeInput" value="" min="1" step="0.01" onchange="updateStake()">
          </div>
        </div>
        
        <div class="ticket-display">
          <div class="ticket-title">Selected Numbers</div>
          <div class="selected-numbers-display" id="selectedNumbers">
            Select numbers to play
          </div>
        </div>
        
        <div class="bet-info-section">
          <div class="section-title">
            <div class="section-icon">üéÆ</div>
            Actions
          </div>
          <div class="action-buttons">
            <button class="btn btn-delete" onclick="deleteAll()">üóëÔ∏è DELETE ALL</button>
            <button class="btn" onclick="confirmTicket()">‚úÖ CONFIRM TICKET</button>
            <button class="btn btn-success" id="play-ticket-btn" onclick="playTicket()">üéÆ PLAY TICKET</button>
          </div>
        </div>
        
        <div class="queued-tickets-section">
          <div class="section-title">
            <div class="section-icon">üé´</div>
            Queued Tickets
          </div>
          <div id="queued-tickets">
          </div>
        </div>
      </div>
    </div>
    
    <div class="footer">
      <div class="footer-left">
        <button class="language-selector">
          üá¨üáß English
        </button>
        <div class="footer-links">
          <a href="#" class="footer-link" onclick="checkSlip()">Check Slip</a>
          <a href="#" class="footer-link" onclick="showTerms()">Terms of Service</a>
          <a href="#" class="footer-link" onclick="showHelp()">Help & Support</a>
        </div>
      </div>
      <div class="footer-right">
        <div id="current-time">03:44 | 15/07/2025</div>
        <div>Cashier Terminal #001</div>
      </div>
    </div>
  </div>

  <script>
    let selectedNumbers = [];
    let currentStake = 0;
    let betType = 'future1';
    let ticketQueue = [];
    let gameState = {
      isRunning: false,
      drawnBalls: [],
      availableBalls: Array.from({length: 48}, (_, i) => i + 1),
      gameId: null,
      currentBall: null,
      recentBalls: [],
      lastUpdate: Date.now(),
      bonusAmounts: { bronze: 705.66, silver: 792.56, gold: 1250.00 },
      players: []
    };

    const connectionStatus = document.getElementById('connection-status');
    const gameIdDisplay = document.getElementById('game-id');
    const currentTime = document.getElementById('current-time');
    const balanceDisplay = document.getElementById('balance');
    const playTicketBtn = document.getElementById('play-ticket-btn');
    const queuedTicketsDisplay = document.getElementById('queued-tickets');

    let socket;
    async function initSocket() {
      const token = localStorage.getItem('token');
      if (!token) {
        showNotification('Please log in first', 'error');
        window.location.href = '/index.html';
        return;
      }
      try {
        const response = await fetch('http://localhost:3000/port', {
          signal: AbortSignal.timeout(2000),
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const data = await response.json();
        socket = io(`http://localhost:${data.port || 3000}`, {
          reconnectionAttempts: 5,
          reconnectionDelay: 1000,
          timeout: 10000,
          auth: { token }
        });
        setupSocketHandlers();
      } catch (err) {
        console.error('Failed to fetch server port:', err);
        showNotification('Failed to connect to server', 'error');
        connectionStatus.textContent = 'Offline';
        document.querySelector('.status-dot').style.background = '#dc2626';
      }
    }

    async function fetchBalance() {
      const token = localStorage.getItem('token');
      // Only fetch if we have a valid gameId from the server
      if (!gameState.gameId) {
        balanceDisplay.textContent = '0.00 NAD';
        return;
      }
      try {
        const response = await fetch(`http://localhost:3000/get-total-earnings?gameId=${gameState.gameId}`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const data = await response.json();
        if (data.success) {
          balanceDisplay.textContent = `${parseFloat(data.totalEarnings).toFixed(2)} NAD`;
        } else {
          showNotification(data.message || 'Failed to fetch balance', 'error');
          balanceDisplay.textContent = '0.00 NAD';
        }
      } catch (err) {
        console.error('Error fetching balance:', err);
        showNotification('Error fetching balance', 'error');
        balanceDisplay.textContent = '0.00 NAD';
      }
    }

    function setupSocketHandlers() {
      socket.on('connect', () => {
        console.log('Socket connected, ID:', socket.id);
        socket.emit('authenticate', localStorage.getItem('token'));
      });

      socket.on('authenticated', ({ role }) => {
        console.log(`Authenticated as ${role}`);
        updateGameStatus();
        showNotification(`Connected as ${role}`, 'success');
        socket.emit('requestGameState');
        fetchTickets();
        // Remove fetchBalance() here, will call after receiving gameState
      });

      socket.on('authError', (message) => {
        console.error('Authentication error:', message);
        showNotification('Authentication failed. Please log in again.', 'error');
        localStorage.removeItem('token');
        window.location.href = '/index.html';
      });

      socket.on('disconnect', () => {
        console.log('Socket disconnected');
        updateGameStatus();
        showNotification('Disconnected from server', 'error');
      });

      socket.on('gameState', (newState) => {
        console.log('Received gameState:', newState);
        gameState = { ...gameState, ...newState };
        updateGameStatus();
        fetchTickets();
        fetchBalance(); // Only call fetchBalance after receiving gameState from server
      });

      socket.on('gameStarted', (data) => {
        console.log('Received gameStarted:', data);
        gameState.isRunning = true;
        gameState.gameId = data.gameId;
        updateGameStatus();
        showNotification('Game started');
      });

      socket.on('ballDrawn', (ballData) => {
        console.log('Received ballDrawn:', ballData);
        gameState.drawnBalls.push(ballData.number);
        gameState.availableBalls = gameState.availableBalls.filter(b => b !== ballData.number);
        gameState.currentBall = ballData.number;
        gameState.recentBalls.unshift(ballData.number);
        if (gameState.recentBalls.length > 10) {
          gameState.recentBalls.pop();
        }
        updateGameStatus();
        showNotification(`Ball drawn: ${ballData.number}`);
      });

      socket.on('bonusBall', (bonusBall) => {
        console.log('Received bonusBall:', bonusBall);
        gameState.bonusBall = bonusBall;
        updateGameStatus();
        showNotification(`Bonus ball drawn: ${bonusBall}`);
      });

      socket.on('winner', (winner) => {
        console.log('Received winner:', winner);
        gameState.winner = winner;
        updateGameStatus();
        showNotification(`Winner: ${winner.player} with prize ${winner.prize}`);
      });

      socket.on('autoDrawPaused', () => {
        console.log('Received autoDrawPaused');
        gameState.isRunning = false;
        gameState.gameId = "BG-" + Math.floor(10000 + Math.random() * 90000);
        gameState.drawnBalls = [];
        gameState.availableBalls = Array.from({length: 48}, (_, i) => i + 1);
        gameState.currentBall = null;
        gameState.recentBalls = [];
        socket.emit('resetGame', { gameId: gameState.gameId });
        updateGameStatus();
        showNotification('Auto draw paused, new game initialized');
      });

      socket.on('autoDrawResumed', () => {
        console.log('Received autoDrawResumed');
        gameState.isRunning = true;
        updateGameStatus();
        showNotification('Auto draw resumed');
      });

      socket.on('error', (message) => {
        console.error('Error from server:', message);
        showNotification(message, 'error');
      });

      socket.on('cashierConnected', ({ cashierCount }) => {
        console.log(`Cashier count updated: ${cashierCount}`);
        updateGameStatus();
      });

      socket.on('ping', (timestamp) => {
        socket.emit('pong', Date.now() - timestamp);
      });

      socket.on('connect_error', (err) => {
        console.error('Connection error:', err.message);
        showNotification('Connection error: ' + err.message, 'error');
        updateGameStatus();
      });

      socket.on('balanceUpdate', ({ gameId, totalEarnings }) => {
        if (gameId === gameState.gameId) {
          balanceDisplay.textContent = `${totalEarnings.toFixed(2)} NAD`;
          showNotification('Balance updated', 'success');
        }
      });
    }

    async function fetchTickets() {
      const token = localStorage.getItem('token');
      try {
        const response = await fetch(`http://localhost:3000/tickets?gameId=${gameState.gameId || ''}`, {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        const data = await response.json();
        if (data.success) {
          gameState.players = data.tickets.map(ticket => ({
            name: ticket.player_name,
            tickets: JSON.parse(ticket.lucky_numbers || '[]'),
            balance: ticket.ticket_price,
            slipNumber: ticket.slip_number,
            wins: 0
          }));
          console.log('Fetched tickets:', gameState.players);
        } else {
          showNotification(data.message || 'Failed to fetch tickets', 'error');
        }
      } catch (err) {
        console.error('Error fetching tickets:', err);
        showNotification('Error fetching tickets', 'error');
      }
    }

    function init() {
      const token = localStorage.getItem('token');
      if (!token) {
        window.location.href = '/index.html';
        return;
      }
      initBallGrid();
      updateSelectedNumbersDisplay();
      renderQueuedTickets();
      updateGameStatus();
      updateTime();
      setInterval(updateTime, 1000);
      initSocket();
      fetchBalance();
    }

    function initBallGrid() {
      const ballGrid = document.getElementById('ballGrid');
      for (let i = 1; i <= 48; i++) {
        const ball = document.createElement('div');
        ball.className = 'ball';
        ball.setAttribute('data-number', i);
        ball.textContent = i;
        ball.addEventListener('click', () => toggleBall(i));
        ballGrid.appendChild(ball);
      }
    }

    function toggleBall(number) {
      const index = selectedNumbers.indexOf(number);
      if (index === -1 && selectedNumbers.length < 48) {
        selectedNumbers.push(number);
        document.querySelector(`.ball[data-number="${number}"]`).classList.add('selected');
      } else if (index !== -1) {
        selectedNumbers.splice(index, 1);
        document.querySelector(`.ball[data-number="${number}"]`).classList.remove('selected');
      }
      updateSelectedNumbersDisplay();
    }

    function updateSelectedNumbersDisplay() {
      const display = document.getElementById('selectedNumbers');
      if (selectedNumbers.length === 0) {
        display.innerHTML = 'Select numbers to play';
      } else {
        const sets = [];
        for (let i = 0; i < Math.floor(selectedNumbers.length / 6); i++) {
          const start = i * 6;
          const end = start + 6;
          const set = selectedNumbers.slice(start, end).sort((a, b) => a - b);
          if (set.length === 6) {
            sets.push(`<div class="selected-numbers-row">${set.join(' - ')}</div>`);
          } else if (selectedNumbers.length >= 6 && i === 0 && set.length > 6 && set.length <= 10) {
            sets.push(`<div class="selected-numbers-row">${set.join(' - ')} (Random ${set.length})</div>`);
          }
        }
        display.innerHTML = sets.length > 0 ? sets.join('') : 'Select numbers to play';
      }
      updatePlayButton();
    }

    function updateBetType() {
      betType = document.getElementById('betType').value;
      updatePlayButton();
    }

    function updateStake() {
      currentStake = parseFloat(document.getElementById('stakeInput').value) || 0;
      updatePlayButton();
    }

    function updatePlayButton() {
      const btn = document.getElementById('play-ticket-btn');
      btn.disabled = !socket.connected || gameState.isRunning || !gameState.gameId || ticketQueue.length === 0;
    }

    function randomSelect(count) {
      // Always clear previous selection and pick exactly 'count' random numbers from 1-48
      selectedNumbers = [];
      const available = Array.from({length: 48}, (_, i) => i + 1);
      while (selectedNumbers.length < count && available.length > 0) {
        const randIdx = Math.floor(Math.random() * available.length);
        const num = available.splice(randIdx, 1)[0];
        selectedNumbers.push(num);
      }
      selectedNumbers.sort((a, b) => a - b);
      updateBallGrid();
      updateSelectedNumbersDisplay();
      // Set stake according to count
      currentStake = count === 6 ? 5.00 : count === 7 ? 6.00 : count === 8 ? 8.00 : count === 9 ? 9.00 : count === 10 ? 10.00 : currentStake;
      document.getElementById('stakeInput').value = currentStake.toFixed(2);
    }

    function quickPick() {
      selectedNumbers = [];
      randomSelect(6);
      updateBallGrid();
      updateSelectedNumbersDisplay();
      currentStake = 5.00;
      document.getElementById('stakeInput').value = currentStake.toFixed(2);
    }

    function firstBallColor() {
      if (!gameState.drawnBalls.length) {
        showNotification('No balls drawn yet', 'error');
        return;
      }
      const colorMap = {
        1: 'Yellow', 2: 'Blue', 3: 'Red', 4: 'Purple', 5: 'Orange',
        6: 'Green', 7: 'Maroon', 8: 'Black', 9: 'Yellow', 10: 'Blue',
        11: 'Red', 12: 'Purple', 13: 'Orange', 14: 'Green', 15: 'Maroon'
      };
      const firstBall = gameState.drawnBalls[0];
      const color = colorMap[firstBall % 15] || 'Unknown';
      showNotification(`First ball color: ${color}`);
    }

    function firstBall24_5() {
      if (!gameState.drawnBalls.length) {
        showNotification('No balls drawn yet', 'error');
        return;
      }
      const firstBall = gameState.drawnBalls[0];
      const result = firstBall > 24.5 ? 'Over' : firstBall < 24.5 ? 'Under' : 'Equal';
      showNotification(`First ball 24.5: ${result}`);
    }

    function firstBallOddEven() {
      if (!gameState.drawnBalls.length) {
        showNotification('No balls drawn yet', 'error');
        return;
      }
      const firstBall = gameState.drawnBalls[0];
      const result = firstBall % 2 === 0 ? 'Even' : 'Odd';
      showNotification(`First ball Odd/Even: ${result}`);
    }

    function winningBallEvenOdd() {
      if (!gameState.winner) {
        showNotification('No winner yet', 'error');
        return;
      }
      const lastBall = gameState.drawnBalls[gameState.drawnBalls.length - 1];
      const result = lastBall % 2 === 0 ? 'Even' : 'Odd';
      showNotification(`Winning ball Odd/Even: ${result}`);
    }

    function playAllColors() {
      // Always clear previous selection and pick 15 random numbers from 1-48
      selectedNumbers = [];
      const available = Array.from({length: 48}, (_, i) => i + 1);
      while (selectedNumbers.length < 15 && available.length > 0) {
        const randIdx = Math.floor(Math.random() * available.length);
        const num = available.splice(randIdx, 1)[0];
        selectedNumbers.push(num);
      }
      selectedNumbers.sort((a, b) => a - b);
      updateBallGrid();
      updateSelectedNumbersDisplay();
      currentStake = 150.00;
      document.getElementById('stakeInput').value = currentStake.toFixed(2);
    }

    function copyTicket() {
      if (selectedNumbers.length === 0) {
        showNotification('No ticket to copy', 'error');
        return;
      }
      navigator.clipboard.writeText(selectedNumbers.join(', '));
      showNotification('Ticket copied to clipboard');
    }

    async function confirmTicket() {
      if (selectedNumbers.length < 6 || (selectedNumbers.length > 6 && selectedNumbers.length > 10)) {
        showNotification('Select 6 to 10 numbers per set', 'error');
        return;
      }
      const ticketSets = [];
      const setSize = selectedNumbers.length;
      let stakeAmount = 0;
      if (setSize >= 6 && setSize <= 10) {
        stakeAmount = setSize === 6 ? 5.00 : setSize === 7 ? 6.00 : setSize === 8 ? 8.00 : setSize === 9 ? 9.00 : 10.00;
        ticketSets.push({
          numbers: [...selectedNumbers].sort((a, b) => a - b),
          stake: stakeAmount,
          type: betType,
          slipNumber: `T-${Math.random().toString(36).substr(2, 9).toUpperCase()}`
        });
      }
      ticketQueue.push(...ticketSets);
      renderQueuedTickets();
      
      const token = localStorage.getItem('token');
      if (token && stakeAmount > 0) {
        try {
          const response = await fetch('http://localhost:3000/earn', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
              gameId: gameState.gameId,
              slipNumber: ticketSets[0].slipNumber,
              playerName: 'CashierUser',
              amount: stakeAmount
            })
          });
          const data = await response.json();
          if (!data.success) {
            showNotification(data.message || 'Failed to record earnings', 'error');
          }
          fetchBalance();
        } catch (err) {
          console.error('Error recording earnings:', err);
          showNotification('Error recording earnings', 'error');
        }
      }

      selectedNumbers = [];
      updateBallGrid();
      updateSelectedNumbersDisplay();
      document.getElementById('stakeInput').value = stakeAmount.toFixed(2);
      showNotification(`Ticket with ${ticketSets.length} set(s) queued`);
    }

    async function playTicket() {
      if (ticketQueue.length === 0) {
        showNotification('No tickets in queue to play', 'error');
        return;
      }
      try {
        for (const ticket of ticketQueue) {
          const ticketData = {
            playerName: 'CashierUser',
            ticketSets: [{
              luckyNumbers: ticket.numbers,
              ticketPrice: ticket.stake
            }],
            slipNumber: ticket.slipNumber
          };
          const response = await fetch('http://localhost:3000/sell-ticket', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${localStorage.getItem('token')}` },
            body: JSON.stringify(ticketData)
          });
          const data = await response.json();
          if (data.success) {
            showNotification(`Ticket ${ticket.slipNumber} sold`);
            const playResponse = await fetch('http://localhost:3000/play-ticket', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${localStorage.getItem('token')}` },
              body: JSON.stringify({ gameId: gameState.gameId })
            });
            const playData = await playResponse.json();
            if (playData.success) {
              showNotification(`Ticket ${ticket.slipNumber} played for game ${gameState.gameId}`);
            } else {
              showNotification(playData.message || `Failed to play ticket ${ticket.slipNumber}`, 'error');
            }
          } else {
            showNotification(data.message || `Failed to sell ticket ${ticket.slipNumber}`, 'error');
          }
        }
        ticketQueue = [];
        renderQueuedTickets();
        updatePlayButton();
        fetchBalance();
      } catch (err) {
        console.error('Error playing tickets:', err);
        showNotification('Error playing tickets', 'error');
      }
    }

    function deleteAll() {
      selectedNumbers = [];
      updateBallGrid();
      updateSelectedNumbersDisplay();
      showNotification('All selections cleared');
    }

    function checkSlip() {
      const slipNumber = prompt('Enter slip number to check:');
      if (!slipNumber) return;
      fetch(`http://localhost:3000/check-slip?slipNumber=${slipNumber}`, {
        method: 'GET',
        headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showNotification(`Slip ${slipNumber} found: ${JSON.stringify(data.ticket)}`);
          } else {
            showNotification(data.message || 'Slip not found', 'error');
          }
        })
        .catch(err => {
          console.error('Error checking slip:', err);
          showNotification('Error checking slip', 'error');
        });
    }

    function showTerms() {
      showNotification('Terms of Service: Please contact support for details.', 'info');
    }

    function showHelp() {
      showNotification('Help & Support: Contact admin@mylucky.com', 'info');
    }

    function updateBallGrid() {
      const balls = document.querySelectorAll('.ball');
      balls.forEach(ball => {
        const num = parseInt(ball.getAttribute('data-number'));
        ball.classList.remove('selected', 'drawn');
        if (selectedNumbers.includes(num)) ball.classList.add('selected');
        if (gameState.drawnBalls.includes(num)) ball.classList.add('drawn');
      });
    }

    function renderQueuedTickets() {
      queuedTicketsDisplay.innerHTML = '';
      ticketQueue.forEach((ticket, index) => {
        const div = document.createElement('div');
        div.className = 'queued-ticket';
        div.innerHTML = `
          <div class="queued-ticket-header">
            <span class="queued-ticket-id">${ticket.slipNumber}</span>
            <span class="queued-ticket-remove" onclick="removeTicket(${index})">‚úñ</span>
          </div>
          <div class="queued-ticket-details">
            Numbers: ${ticket.numbers.join(', ')}<br>
            Stake: ${ticket.stake.toFixed(2)} NAD<br>
            Type: ${ticket.type}
          </div>
        `;
        queuedTicketsDisplay.appendChild(div);
      });
    }

    function removeTicket(index) {
      ticketQueue.splice(index, 1);
      renderQueuedTickets();
      updatePlayButton();
      showNotification('Ticket removed from queue');
    }

    function updateGameStatus() {
      connectionStatus.textContent = socket.connected ? 'Online' : 'Offline';
      document.querySelector('.status-dot').style.background = socket.connected ? '#22c55e' : '#dc2626';
      gameIdDisplay.textContent = gameState.gameId || 'Waiting...';
      playTicketBtn.disabled = !socket.connected || gameState.isRunning || !gameState.gameId || ticketQueue.length === 0;
      updateBallGrid();
      renderQueuedTickets();
      // Optionally, fetchBalance() here if you want to update on every status change
      // fetchBalance();
    }

    function showNotification(message, type = 'success') {
      const div = document.createElement('div');
      div.className = `fixed top-4 right-4 p-3 rounded-lg shadow-lg text-white ${type === 'error' ? 'bg-red-600' : type === 'info' ? 'bg-blue-600' : 'bg-green-600'}`;
      div.textContent = message;
      document.body.appendChild(div);
      setTimeout(() => div.remove(), 3000);
    }

    function updateTime() {
      const now = new Date();
      currentTime.textContent = now.toLocaleTimeString('en-US', { timeZone: 'Africa/Windhoek' }) + ' | ' +
        now.toLocaleDateString('en-US', { timeZone: 'Africa/Windhoek' });
    }

    function randomMulti() {
      const maxSets = Math.floor((48 - selectedNumbers.length) / 6);
      if (maxSets < 1) {
        showNotification('Not enough available numbers for another set', 'error');
        return;
      }
      const setsToAdd = parseInt(prompt(`Enter number of sets (1-${maxSets}):`) || 1);
      if (setsToAdd < 1 || setsToAdd > maxSets) {
        showNotification(`Please enter a number between 1 and ${maxSets}`, 'error');
        return;
      }
      const available = [...gameState.availableBalls.filter(b => !selectedNumbers.includes(b))];
      for (let i = 0; i < setsToAdd; i++) {
        const set = [];
        while (set.length < 6 && available.length > 0) {
          const rand = Math.floor(Math.random() * available.length);
          const num = available[rand];
          if (!set.includes(num)) set.push(num);
          available.splice(rand, 1);
        }
        selectedNumbers.push(...set);
      }
      selectedNumbers.sort((a, b) => a - b);
      updateBallGrid();
      updateSelectedNumbersDisplay();
      currentStake = setsToAdd * 5;
      document.getElementById('stakeInput').value = currentStake.toFixed(2);
    }

    document.addEventListener('DOMContentLoaded', () => {
      initSocket();
      initBallGrid();
      setInterval(updateTime, 1000);
      updateTime();
      updatePlayButton();
      // Remove fetchBalance() here, will be called after receiving gameState
    });
  </script>
</body>
</html>