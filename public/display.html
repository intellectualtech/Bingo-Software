<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Professional Bingo Ball Display</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap');
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Montserrat', sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, #051937, #004d7a);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      overflow-x: hidden;
    }
    
    .container {
      width: 100%;
      max-width: 1200px;
      padding: 20px;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 2px solid rgba(255, 255, 255, 0.2);
      margin-bottom: 20px;
    }
    
    .logo {
      font-size: 2.5rem;
      font-weight: 800;
      background: linear-gradient(to right, #ff8a00, #e52e71);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }
    
    .status {
      display: flex;
      gap: 20px;
      align-items: center;
    }
    
    .status-item {
      text-align: center;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 8px 15px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(5px);
    }
    
    .status-item h3 {
      font-size: 0.8rem;
      opacity: 0.8;
      margin-bottom: 3px;
    }
    
    .status-item p {
      font-size: 1.2rem;
      font-weight: 600;
    }
    
    .main-display {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 30px;
    }
    
    .ball-container {
      position: relative;
      width: 300px;
      height: 300px;
      margin: 20px 0;
    }
    
    .machine-bg {
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #444, #222);
      box-shadow: 
        inset 0 0 50px rgba(0, 0, 0, 0.6),
        0 0 30px rgba(0, 0, 0, 0.4),
        0 10px 20px rgba(0, 0, 0, 0.4);
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .machine-bg::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, transparent 0%, rgba(255, 255, 255, 0.1) 100%);
      border-radius: 50%;
    }
    
    .machine-rim {
      position: absolute;
      width: calc(100% + 20px);
      height: calc(100% + 20px);
      top: -10px;
      left: -10px;
      border-radius: 50%;
      border: 15px solid #333;
      box-shadow: 
        inset 0 0 10px rgba(255, 255, 255, 0.3),
        0 0 20px rgba(0, 0, 0, 0.5);
      pointer-events: none;
    }
    
    .ball {
      position: relative;
      width: 200px;
      height: 200px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 5rem;
      font-weight: 700;
      color: #333;
      z-index: 2;
      transform: scale(0);
      box-shadow: 
        inset -10px -10px 20px rgba(0, 0, 0, 0.2),
        inset 10px 10px 20px rgba(255, 255, 255, 0.5),
        0 0 30px rgba(0, 0, 0, 0.3);
    }
    
    .ball-shine {
      position: absolute;
      width: 60px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.4);
      top: 35px;
      left: 40px;
      transform: rotate(-30deg);
      filter: blur(5px);
    }
    
    .ball-letter {
      position: absolute;
      top: -40px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 2rem;
      font-weight: 800;
      opacity: 0;
    }
    
    .call-display {
      margin-top: 20px;
      text-align: center;
      font-size: 1.8rem;
      min-height: 40px;
      font-weight: 600;
    }
    
    .info-section {
      display: flex;
      gap: 20px;
      margin-top: 20px;
      margin-bottom: 30px;
    }
    
    .recent-balls {
      flex: 2;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 15px;
      padding: 15px;
      overflow: hidden;
    }
    
    .recent-balls h2, .board-section h2 {
      font-size: 1.3rem;
      margin-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .balls-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: flex-start;
    }
    
    .small-ball {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1.2rem;
      position: relative;
      box-shadow: 
        inset -2px -2px 5px rgba(0, 0, 0, 0.2),
        inset 2px 2px 5px rgba(255, 255, 255, 0.3),
        0 3px 5px rgba(0, 0, 0, 0.2);
    }
    
    .small-ball::after {
      content: '';
      position: absolute;
      width: 12px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.4);
      top: 8px;
      left: 10px;
      transform: rotate(-30deg);
    }
    
    .board-section {
      flex: 1;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 15px;
      padding: 15px;
    }
    
    .bingo-board {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 5px;
      position: relative;
    }
    
    .board-letter {
      background: linear-gradient(135deg, #ff8a00, #e52e71);
      color: white;
      padding: 8px 0;
      text-align: center;
      font-weight: 700;
      border-radius: 5px;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
      position: relative;
    }
    
    .number-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 5px;
      margin-top: 5px;
    }
    
    .board-number {
      background: rgba(255, 255, 255, 0.1);
      padding: 3px 0;
      text-align: center;
      border-radius: 5px;
      font-size: 0.8rem;
      transition: all 0.3s ease;
    }
    
    .number-called {
      background: rgba(46, 204, 113, 0.3);
      color: #2ecc71;
      font-weight: 600;
    }
    
    .controls {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
    }
    
    .control-btn {
      background: linear-gradient(135deg, #1a2a6c, #b21f1f);
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 30px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .control-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
    }
    
    .control-btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 3px rgba(0, 0, 0, 0.2);
    }
    
    .game-info {
      margin-top: 20px;
      text-align: center;
      font-size: 0.9rem;
      opacity: 0.8;
    }
    
    .previous-ball-display {
      display: flex;
      justify-content: space-between;
      width: 100%;
      margin-top: 20px;
    }
    
    .prev-ball-container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .prev-ball-label {
      font-size: 0.8rem;
      margin-bottom: 5px;
      opacity: 0.7;
    }
    
    .prev-ball {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      position: relative;
      box-shadow: 
        inset -3px -3px 7px rgba(0, 0, 0, 0.2),
        inset 3px 3px 7px rgba(255, 255, 255, 0.3),
        0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .prize-balls {
      display: flex;
      gap: 15px;
      margin-top: 20px;
      justify-content: center;
    }
    
    .prize-ball {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .prize-ball-label {
      font-size: 0.9rem;
      margin-bottom: 5px;
      font-weight: 600;
    }
    
    .ball-B, .small-ball-B {
      background: linear-gradient(135deg, #ff8a00, #e52e71);
      color: white;
    }
    
    .ball-I, .small-ball-I {
      background: linear-gradient(135deg, #21d4fd, #2750b8);
      color: white;
    }
    
    .ball-N, .small-ball-N {
      background: linear-gradient(135deg, #dce35b, #45b649);
      color: white;
    }
    
    .ball-G, .small-ball-G {
      background: linear-gradient(135deg, #8a2be2, #4a00e0);
      color: white;
    }
    
    .ball-O, .small-ball-O {
      background: linear-gradient(135deg, #f857a6, #ff5858);
      color: white;
    }
    
    .gold-ball {
      background: linear-gradient(135deg, #FFD700, #DAA520);
      color: white;
    }
    
    .bronze-ball {
      background: linear-gradient(135deg, #cd7f32, #a04000);
      color: white;
    }
    
    .countdown {
      font-size: 1.5rem;
      font-weight: 600;
      margin: 15px 0;
      text-align: center;
      opacity: 0;
    }
    
    .fade-in {
      animation: fadeIn 0.5s forwards;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    
    .bounce-in {
      animation: bounceIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }
    
    @keyframes bounceIn {
      0% {
        transform: scale(0);
      }
      80% {
        transform: scale(1.1);
      }
      100% {
        transform: scale(1);
      }
    }
    
    .pulse {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% {
        transform: scale(1);
        opacity: 1;
      }
      50% {
        transform: scale(1.05);
        opacity: 0.8;
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    .travel-ball {
      position: absolute;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1.2rem;
      z-index: 10;
    }
    
    .footer {
      text-align: center;
      margin-top: 20px;
      font-size: 0.8rem;
      opacity: 0.6;
    }

    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }
      
      .header {
        flex-direction: column;
        gap: 10px;
      }
      
      .status {
        width: 100%;
        justify-content: space-between;
      }
      
      .info-section {
        flex-direction: column;
      }
      
      .ball-container {
        width: 220px;
        height: 220px;
      }
      
      .ball {
        width: 160px;
        height: 160px;
        font-size: 4rem;
      }

      .bingo-board {
        grid-template-columns: repeat(4, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo">PROFESSIONAL BINGO</div>
      <div class="status">
        <div class="status-item">
          <h3>GAME ID</h3>
          <p id="game-id">BG-25319</p>
        </div>
        <div class="status-item">
          <h3>DRAWN</h3>
          <p id="balls-drawn">0</p>
        </div>
        <div class="status-item">
          <h3>REMAINING</h3>
          <p id="balls-remaining">48</p>
        </div>
      </div>
    </div>
    
    <div class="main-display">
      <div class="countdown" id="countdown">NEXT BALL IN: 5</div>
      <div class="ball-container">
        <div class="machine-bg"></div>
        <div class="machine-rim"></div>
        <div id="current-ball" class="ball">
          <div class="ball-shine"></div>
          <span id="ball-number"></span>
        </div>
        <div id="ball-letter" class="ball-letter">B</div>
      </div>
      <div class="call-display" id="call-display"></div>
      
      <div class="previous-ball-display">
        <div class="prev-ball-container">
          <div class="prev-ball-label">PREVIOUS</div>
          <div id="prev-ball-1" class="prev-ball">-</div>
        </div>
        <div class="prev-ball-container">
          <div class="prev-ball-label">2ND LAST</div>
          <div id="prev-ball-2" class="prev-ball">-</div>
        </div>
        <div class="prev-ball-container">
          <div class="prev-ball-label">3RD LAST</div>
          <div id="prev-ball-3" class="prev-ball">-</div>
        </div>
      </div>
    </div>
    
    <div class="info-section">
      <div class="recent-balls">
        <h2><i class="fas fa-history"></i> CALLED NUMBERS</h2>
        <div id="balls-grid" class="balls-grid"></div>
      </div>
      
      <div class="board-section">
        <h2><i class="fas fa-th"></i> BINGO BOARD</h2>
        <div class="bingo-board">
          <div class="board-letter" data-letter="B">B</div>
          <div class="board-letter" data-letter="I">I</div>
          <div class="board-letter" data-letter="N">N</div>
          <div class="board-letter" data-letter="G">G</div>
        </div>
        <div id="number-board"></div>
      </div>
    </div>
    
    <div class="prize-balls">
      <div class="prize-ball">
        <div class="prize-ball-label">GOLD BONUS</div>
        <div id="gold-bonus" class="small-ball gold-ball">-</div>
      </div>
      <div class="prize-ball">
        <div class="prize-ball-label">BRONZE BONUS</div>
        <div id="bronze-bonus" class="small-ball bronze-ball">-</div>
      </div>
    </div>
    
    <div class="controls">
      <button id="draw-btn" class="control-btn" disabled>
        <i class="fas fa-play"></i> DRAW BALL
      </button>
      <button id="reset-btn" class="control-btn" disabled>
        <i class="fas fa-redo"></i> RESET GAME
      </button>
    </div>
    
    <div class="game-info">
      Game in progress • Started: <span id="start-time">19 May 2025, 10:26 PM</span> • Prize: $10,000
    </div>
    
    <div class="footer">
      © 2025 Professional Bingo Systems • Live Stream Active
    </div>
  </div>

  <script>
    const socket = io();
    let gameState = { 
      isRunning: false, 
      drawnBalls: [], 
      availableBalls: Array.from({length: 48}, (_, i) => i + 1),
      gameId: "BG-" + Math.floor(10000 + Math.random() * 90000),
      startTime: new Date('2025-05-19T22:26:00+02:00'), // 10:26 PM CAT
      bonusBall: null,
      winner: null
    };
    
    const currentBall = document.getElementById('current-ball');
    const ballNumber = document.getElementById('ball-number');
    const ballLetter = document.getElementById('ball-letter');
    const callDisplay = document.getElementById('call-display');
    const ballsDrawn = document.getElementById('balls-drawn');
    const ballsRemaining = document.getElementById('balls-remaining');
    const ballsGrid = document.getElementById('balls-grid');
    const numberBoard = document.getElementById('number-board');
    const countdown = document.getElementById('countdown');
    const drawBtn = document.getElementById('draw-btn');
    const resetBtn = document.getElementById('reset-btn');
    const gameId = document.getElementById('game-id');
    const startTime = document.getElementById('start-time');
    const prevBall1 = document.getElementById('prev-ball-1');
    const prevBall2 = document.getElementById('prev-ball-2');
    const prevBall3 = document.getElementById('prev-ball-3');
    const goldBonus = document.getElementById('gold-bonus');
    const bronzeBonus = document.getElementById('bronze-bonus');

    let animationInterval = null;
    let shuffledNumbers = [];
    let usedNumbers = new Set();

    function getBallLetter(number) {
      if (number <= 12) return 'B';
      if (number <= 24) return 'I';
      if (number <= 36) return 'N';
      if (number <= 48) return 'G';
      return 'G';
    }
    
    function getLetterClass(letter) {
      return `ball-${letter}`;
    }
    
    function createSmallBall(number) {
      const letter = getBallLetter(number);
      const letterClass = getLetterClass(letter);
      
      const ball = document.createElement('div');
      ball.className = `small-ball small-ball-${letter}`;
      ball.classList.add(letterClass);
      ball.textContent = number;
      ball.dataset.number = number;
      
      return ball;
    }
    
    function createTravelBall(number) {
      const letter = getBallLetter(number);
      const letterClass = getLetterClass(letter);
      
      const ball = document.createElement('div');
      ball.className = `travel-ball small-ball-${letter}`;
      ball.classList.add(letterClass);
      ball.textContent = number;
      ball.style.display = 'none';
      document.body.appendChild(ball);
      return ball;
    }
    
    function initializeBingoBoard() {
      numberBoard.innerHTML = '';
      
      for (let i = 1; i <= 12; i += 3) {
        const rowContainer = document.createElement('div');
        rowContainer.className = 'number-row';
        
        for (let j = 0; j < 4; j++) {
          const startNum = j * 12 + 1;
          const endNum = Math.min(startNum + 11, (j + 1) * 12);
          const range = document.createElement('div');
          range.className = 'board-number';
          range.textContent = `${startNum}-${endNum}`;
          rowContainer.appendChild(range);
        }
        
        numberBoard.appendChild(rowContainer);
      }
      
      for (let i = 1; i <= 48; i += 12) {
        const rowContainer = document.createElement('div');
        rowContainer.className = 'number-row';
        
        for (let j = 0; j < 4; j++) {
          const num = i + j * 12 - 1;
          if (num < 48) {
            const numEl = document.createElement('div');
            numEl.className = 'board-number';
            numEl.textContent = num + 1;
            numEl.dataset.number = num + 1;
            rowContainer.appendChild(numEl);
          }
        }
        
        numberBoard.appendChild(rowContainer);
      }
    }
    
    function drawBall() {
      if (gameState.availableBalls.length === 0) {
        alert('All balls have been drawn! Round ended. Please verify wins at the cashier.');
        return;
      }
      
      fetch('/draw-ball', { method: 'POST' })
        .then(response => response.json())
        .then(data => {
          if (data.error) {
            alert(data.error);
          }
        });
    }
    
    function animateBallToGroup(number) {
      const letter = getBallLetter(number);
      const letterElement = document.querySelector(`.board-letter[data-letter="${letter}"]`);
      const letterRect = letterElement.getBoundingClientRect();
      const ballRect = currentBall.getBoundingClientRect();
      
      const travelBall = createTravelBall(number);
      travelBall.style.display = 'block';
      travelBall.style.left = `${ballRect.left + ballRect.width / 2 - 20}px`;
      travelBall.style.top = `${ballRect.top + ballRect.height / 2 - 20}px`;
      
      gsap.to(travelBall, {
        x: letterRect.left + letterRect.width / 2 - ballRect.left - ballRect.width / 2,
        y: letterRect.top + letterRect.height / 2 - ballRect.top - ballRect.height / 2,
        scale: 0.5,
        duration: 1,
        ease: "power2.inOut",
        onComplete: () => {
          travelBall.remove();
        }
      });
    }
    
    function revealBall(number, isIdle = false) {
      const letter = getBallLetter(number);
      const letterClass = getLetterClass(letter);
      
      currentBall.className = `ball ${letterClass}`;
      ballNumber.textContent = number;
      ballLetter.textContent = letter;
      ballLetter.style.opacity = 0;
      
      gsap.to(currentBall, {
        scale: 1.2,
        duration: 0.5,
        ease: "back.out(1.7)",
        onComplete: () => {
          gsap.to(currentBall, {
            scale: 1,
            duration: 0.3
          });
          
          gsap.to(ballLetter, {
            opacity: 1,
            duration: 0.3,
            y: 0
          });
          
          setTimeout(() => {
            if (!isIdle) {
              showCallPhrase(letter, number);
            }
            setTimeout(() => {
              animateBallToGroup(number);
              if (!isIdle) {
                gsap.to(currentBall, {
                  scale: 0,
                  duration: 0.5,
                  ease: "back.in"
                });
                ballLetter.style.opacity = 0;
              }
            }, isIdle ? 1500 : 3000); // Display longer during game
          }, 800);
        }
      });
    }
    
    function showCallPhrase(letter, number) {
      const calls = {
        B: { 1: "B-1, At the beginning", 2: "B-2, One plus one", 3: "B-3, Cup of tea", 4: "B-4, Knock at the door", 5: "B-5, Man alive", 6: "B-6, Half a dozen", 7: "B-7, Lucky seven", 8: "B-8, Garden gate", 9: "B-9, Doctor's orders", 10: "B-10, Prime Minister's den", 11: "B-11, Legs eleven", 12: "B-12, Dozen" },
        I: { 13: "I-13, Unlucky for some", 14: "I-14, Valentine's day", 15: "I-15, Young and keen", 16: "I-16, Sweet sixteen", 17: "I-17, Dancing queen", 18: "I-18, Coming of age", 19: "I-19, Goodbye teens", 20: "I-20, One score", 21: "I-21, Key of the door", 22: "I-22, Two little ducks", 23: "I-23, The Lord is my Shepherd", 24: "I-24, Two dozen" },
        N: { 25: "N-25, Duck and dive", 26: "N-26, Half a crown", 27: "N-27, Gateway to heaven", 28: "N-28, In a state", 29: "N-29, Rise and shine", 30: "N-30, Dirty thirty", 31: "N-31, Get up and run", 32: "N-32, Buckle my shoe", 33: "N-33, Dirty knees", 34: "N-34, Ask for more", 35: "N-35, Jump and jive", 36: "N-36, Three dozen" },
        G: { 37: "G-37, More than eleven", 38: "G-38, Christmas cake", 39: "G-39, Steps", 40: "G-40, Life begins", 41: "G-41, Time for fun", 42: "G-42, Winnie the Pooh", 43: "G-43, Down on your knees", 44: "G-44, All the fours", 45: "G-45, Halfway there", 46: "G-46, Up to tricks", 47: "G-47, Four and seven", 48: "G-48, Four dozen" }
      };
      
      const call = calls[letter]?.[number] || `${letter}-${number}`;
      callDisplay.textContent = call;
      
      gsap.fromTo(callDisplay, { opacity: 0, y: -20 }, { opacity: 1, y: 0, duration: 0.5 });
    }
    
    function updatePreviousBalls() {
      if (gameState.drawnBalls.length > 0) {
        const current = gameState.drawnBalls[gameState.drawnBalls.length - 1];
        const letter = getBallLetter(current);
        const letterClass = getLetterClass(letter);
        
        prevBall3.textContent = prevBall2.textContent;
        prevBall3.className = prevBall2.className;
        
        prevBall2.textContent = prevBall1.textContent;
        prevBall2.className = prevBall1.className;
        
        prevBall1.textContent = current;
        prevBall1.className = `prev-ball ${letterClass}`;
      }
    }
    
    function addToCalledBalls(number) {
      const ball = createSmallBall(number);
      ball.classList.add('bounce-in');
      ballsGrid.prepend(ball);
    }
    
    function updateBingoBoard(number) {
      const boardNumbers = document.querySelectorAll('.board-number');
      boardNumbers.forEach(numEl => {
        if (parseInt(numEl.dataset.number) === number) {
          numEl.classList.add('number-called');
        }
      });
    }
    
    function resetGame() {
      fetch('/reset-game', { method: 'POST' })
        .then(response => response.json())
        .then(data => {
          if (data.message) {
            alert(data.message);
          }
        });
    }
    
    function formatDate(date) {
      const options = { day: 'numeric', month: 'short', year: 'numeric', hour: 'numeric', minute: 'numeric', hour12: true };
      return date.toLocaleDateString('en-US', options);
    }
    
    function animateBackgroundBalls() {
      const machineBg = document.querySelector('.machine-bg');
      
      for (let i = 0; i < 10; i++) {
        const floatingBall = document.createElement('div');
        floatingBall.className = 'small-ball';
        
        const letters = ['B', 'I', 'N', 'G'];
        const randomLetter = letters[Math.floor(Math.random() * letters.length)];
        floatingBall.classList.add(`small-ball-${randomLetter}`);
        
        const size = Math.random() * 15 + 15;
        floatingBall.style.width = `${size}px`;
        floatingBall.style.height = `${size}px`;
        floatingBall.style.fontSize = `${size * 0.5}px`;
        floatingBall.style.position = 'absolute';
        floatingBall.style.opacity = '0.6';
        
        const letterStartNum = (['B', 'I', 'N', 'G'].indexOf(randomLetter) * 12) + 1;
        floatingBall.textContent = Math.floor(Math.random() * 12) + letterStartNum;
        
        machineBg.appendChild(floatingBall);
        animateFloatingBall(floatingBall);
      }
    }
    
    function animateFloatingBall(ball) {
      const startX = Math.random() * 80 - 40;
      const startY = Math.random() * 80 - 40;
      
      ball.style.left = `calc(50% + ${startX}px)`;
      ball.style.top = `calc(50% + ${startY}px)`;
      
      gsap.to(ball, {
        x: Math.random() * 60 - 30,
        y: Math.random() * 60 - 30,
        duration: Math.random() * 3 + 2,
        ease: "sine.inOut",
        repeat: -1,
        yoyo: true
      });
      
      gsap.to(ball, {
        rotation: Math.random() * 360,
        duration: Math.random() * 4 + 3,
        ease: "none",
        repeat: -1
      });
    }
    
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    
    function startNumberAnimation() {
      if (shuffledNumbers.length === 0) {
        shuffledNumbers = shuffleArray(Array.from({length: 48}, (_, i) => i + 1));
        usedNumbers.clear();
      }
      
      let index = 0;
      animationInterval = setInterval(() => {
        if (usedNumbers.size >= 48) {
          usedNumbers.clear();
          shuffledNumbers = shuffleArray(Array.from({length: 48}, (_, i) => i + 1));
          index = 0;
        }
        
        const number = shuffledNumbers[index];
        usedNumbers.add(number);
        revealBall(number, true);
        index = (index + 1) % 48;
      }, 2500); // Adjusted for animation duration (1.5s display, 1s to group)
    }
    
    function stopNumberAnimation() {
      if (animationInterval) {
        clearInterval(animationInterval);
        animationInterval = null;
        currentBall.style.transform = 'scale(0)';
        ballLetter.style.opacity = 0;
        callDisplay.textContent = '';
      }
    }
    
    function displayAllBalls() {
      ballsGrid.innerHTML = '';
      const allBalls = Array.from({length: 48}, (_, i) => i + 1);
      allBalls.forEach(ball => {
        const smallBall = createSmallBall(ball);
        smallBall.classList.add('bounce-in');
        ballsGrid.appendChild(smallBall);
      });
    }
    
    function initGame() {
      gameId.textContent = gameState.gameId;
      startTime.textContent = formatDate(gameState.startTime);
      ballsDrawn.textContent = gameState.drawnBalls.length;
      ballsRemaining.textContent = gameState.availableBalls.length;
      initializeBingoBoard();
      animateBackgroundBalls();
      startNumberAnimation();
    }
    
    function updateUI() {
      ballsDrawn.textContent = 48 - gameState.availableBalls.length;
      ballsRemaining.textContent = gameState.availableBalls.length;
      gameId.textContent = gameState.gameId;
      startTime.textContent = formatDate(gameState.startTime);
      
      if (gameState.isRunning) {
        stopNumberAnimation();
        displayAllBalls();
        
        if (gameState.drawnBalls.length > 0) {
          const lastBall = gameState.drawnBalls[gameState.drawnBalls.length - 1];
          revealBall(lastBall);
          updatePreviousBalls();
          addToCalledBalls(lastBall);
          updateBingoBoard(lastBall);
        }
        
        if (gameState.availableBalls.length === 0) {
          // Automatically end the round
          callDisplay.textContent = "Round Ended! Verify your wins at the cashier.";
          drawBtn.disabled = true;
          resetBtn.disabled = false;
          fetch('/stop-game', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
              if (data.message) {
                console.log(data.message);
              }
            });
        }
      } else {
        startNumberAnimation();
        ballsGrid.innerHTML = '';
        prevBall1.textContent = '-';
        prevBall2.textContent = '-';
        prevBall3.textContent = '-';
        prevBall1.className = 'prev-ball';
        prevBall2.className = 'prev-ball';
        prevBall3.className = 'prev-ball';
        goldBonus.textContent = '-';
        bronzeBonus.textContent = '-';
        initializeBingoBoard();
      }
      
      if (gameState.bonusBall) {
        goldBonus.textContent = gameState.bonusBall;
        gsap.fromTo(goldBonus, { scale: 0 }, { scale: 1, duration: 0.5, ease: "back.out" });
      }
      if (gameState.winner) {
        callDisplay.textContent = `Winner: ${gameState.winner}!`;
        gsap.fromTo(callDisplay, { opacity: 0, y: -20 }, { opacity: 1, y: 0, duration: 0.5 });
      }
    }
    
    drawBtn.addEventListener('click', drawBall);
    resetBtn.addEventListener('click', resetGame);
    
    socket.on('gameState', (newState) => {
      gameState = newState;
      updateUI();
      drawBtn.disabled = !gameState.isRunning || gameState.availableBalls.length === 0;
      resetBtn.disabled = gameState.isRunning;
    });
    
    socket.on('bonusBall', (bonusBall) => {
      gameState.bonusBall = bonusBall;
      goldBonus.textContent = bonusBall;
      gsap.fromTo(goldBonus, { scale: 0 }, { scale: 1, duration: 0.5, ease: "back.out" });
    });
    
    initGame();
  </script>
</body>
</html>